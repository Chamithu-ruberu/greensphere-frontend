<!DOCTYPE html>
<html
  lang="en"
  xmlns:th="http://www.thymeleaf.org"
  xmlns="http://www.w3.org/1999/html"
>
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />
    <!-- plugins:css -->
    <link rel="stylesheet" href="vendors/ti-icons/css/themify-icons.css" />
    <link rel="stylesheet" href="vendors/base/vendor.bundle.base.css" />
    <!-- endinject -->
    <!-- plugin css for this page -->
    <!-- End plugin css for this page -->
    <!-- inject:css -->
    <link rel="stylesheet" href="css/style.css" />
    <!-- endinject -->
    <link rel="shortcut icon" href="images/gs-logo-.png" />
    <style>
      @import url("https://fonts.googleapis.com/css2?family=Poppins:wght@200;300;400;500;600;700&display=swap");
      @import url("https://fonts.googleapis.com/css2?family=Noto+Sans:ital,wght@0,400;0,700;1,400;1,700&display=swap");
    </style>
  </head>

  <body>
    <div class="container-scroller">
      <div class="p-0 m-0 row proBanner" id="proBanner">
        <div class="p-0 m-0 col-md-12">
          <div
            class="card-body card-body-padding d-flex align-items-center justify-content-between"
          >
            <div class="d-flex align-items-center justify-content-between">
              <a href="https://www.bootstrapdash.com/product/royalui/"
                ><i class="text-white ti-home me-3"></i
              ></a>
              <button id="bannerClose" class="p-0 border-0 btn">
                <i class="text-white ti-close me-0"></i>
              </button>
            </div>
          </div>
        </div>
      </div>
      <!-- partial:partials/_navbar.html -->
      <nav class="flex-row p-0 navbar col-lg-12 col-12 fixed-top d-flex">
        <div
          class="text-center navbar-brand-wrapper d-flex align-items-center justify-content-center"
        >
          <a
            class="navbar-brand brand-logo me-5"
            href="/AppUserDashboard/appUserHome.html"
            ><img src="images/gs-logo-3.png" class="me-2" alt="logo"
          /></a>
          <a
            class="navbar-brand brand-logo-mini"
            href="/AppUserDashboard/appUserHome.html"
            ><img src="images/gs-logo.png" alt="logo"
          /></a>
        </div>
        <div
          class="navbar-menu-wrapper d-flex align-items-center justify-content-end"
        >
          <button
            class="navbar-toggler align-self-center"
            type="button"
            data-toggle="minimize"
          >
            <span class="ti-view-list"></span>
          </button>
          <ul class="navbar-nav mr-lg-2">
            <li class="nav-item nav-search d-none d-lg-block">
              <div class="input-group">
                <div
                  class="input-group-prepend hover-cursor"
                  id="navbar-search-icon"
                >
                  <span class="input-group-text" id="search">
                    <i class="ti-search"></i>
                  </span>
                </div>
                <input
                  type="text"
                  class="form-control"
                  id="navbar-search-input"
                  placeholder="Search now"
                  aria-label="search"
                  aria-describedby="search"
                />
              </div>
            </li>
          </ul>
          <ul class="navbar-nav navbar-nav-right">
            <li class="nav-item dropdown me-1">
              <a
                class="nav-link count-indicator dropdown-toggle d-flex justify-content-center align-items-center"
                id="messageDropdown"
                href="#"
                data-bs-toggle="dropdown"
              >
              <i id="nameDisplay"></i>
              <script>
                  const name = localStorage.getItem("fullName");
                  document.getElementById("nameDisplay").textContent = 'Hi '+ name || 'Guest'; // Default to 'Guest' if name is null
              </script>
              
              </a>
       
            </li>
            
            </li>
            <li class="nav-item nav-profile dropdown">
              <a
                class="nav-link dropdown-toggle"
                href="#"
                data-bs-toggle="dropdown"
                id="profileDropdown"
              >
                <img src="https://static.vecteezy.com/system/resources/previews/021/548/095/original/default-profile-picture-avatar-user-avatar-icon-person-icon-head-icon-profile-picture-icons-default-anonymous-user-male-and-female-businessman-photo-placeholder-social-network-avatar-portrait-free-vector.jpg" alt="profile"  />
              </a>
              <div
                class="dropdown-menu dropdown-menu-right navbar-dropdown"
                aria-labelledby="profileDropdown"
              >
                <a class="dropdown-item" href="AppUserProfile.html">
                  <i class="ti-settings text-primary"></i>
                  Settings
                </a>
                <a class="dropdown-item" onclick="handleLogout()">
                  <i class="ti-power-off text-primary"></i>
                  Logout
                </a>
              </div>
            </li>
          </ul>
          <button
            class="navbar-toggler navbar-toggler-right d-lg-none align-self-center"
            type="button"
            data-toggle="offcanvas"
          >
            <span class="ti-view-list"></span>
          </button>
        </div>
      </nav>
      <!-- partial -->
      <div class="container-fluid page-body-wrapper">
        <!-- partial:partials/_sidebar.html -->
        <nav class="sidebar sidebar-offcanvas" id="sidebar">
          <ul class="nav">
            <li class="nav-item">
              <a class="nav-link" href="appUserHome.html">
                <i class="ti-shield menu-icon"></i>
                <span class="menu-title">Dashboard</span>
              </a>
            </li>

            <li class="nav-item">
              <a class="nav-link" href="/AppUserDashboard/AppUserBilling.html">
                <i class="ti-view-list-alt menu-icon"></i>
                <span class="menu-title">Checkout</span>
              </a>
            </li>

     
              <li class="nav-item">
                  <a id="copyUrlLink" class="nav-link" data-bs-toggle="collapse" href="#auth">
                      <i class="ti-user menu-icon"></i>
                      <span class="menu-title">Invite Friends +</span>
                  </a>
              </li>
        
      
          <script>
              // Function to copy current URL to clipboard
              function copyCurrentUrl() {
                  const url = window.location.href;
                  navigator.clipboard.writeText(url).then(() => {
                      alert('URL copied to clipboard!');
                  }).catch(err => {
                      console.error('Failed to copy URL: ', err);
                  });
              }
      
              // Attach event listener to the link
              document.getElementById('copyUrlLink').addEventListener('click', function(event) {
                  event.preventDefault(); // Prevent the default action
                  copyCurrentUrl();
              });
          </script>

          </ul>
        </nav>
        <script>
          function handleLogout() {
            const token = localStorage.getItem("token");

            if (token) {
              fetch("http://localhost:8082/user/logout", {
                method: "POST",
                headers: {
                  "Content-Type": "application/json",
                },
                body: JSON.stringify({ token: token }),
              })
                .then((response) => {
                  if (response.ok) {
                    // Clear all local storage
                    localStorage.clear();

                    // Redirect to the index page
                    window.location.href = "/index.html";
                  } else {
                    console.error("Logout failed");
                    // Handle any errors here
                  }
                })
                .catch((error) => {
                  console.error("An error occurred:", error);
                });
            } else {
              console.error("No token found in local storage");
              // Handle the case where the token is missing
            }
          }
        </script>
        <!-- partial -->
        <div class="main-panel">
          <div class="content-wrapper">
            <div class="row">
              <div class="col-md-12 grid-margin">
                <div class="d-flex justify-content-between align-items-center">
                  <div>
                    <h4 class="mb-0 font-weight-bold">
                      Greensphere Waste Collection Service
                    </h4>
                  </div>
                  <div id="userPointsContainer" class="flex flex-row">
                    <p>Your points :</p>
                    <p id="userPoints">Fetching user points...</p>
                </div>
                <style>
                  .flex {
    display: flex; /* Ensures the container uses Flexbox */
}

.flex-row {
    flex-direction: row; /* Aligns the children in a row */
    align-items: center; /* Aligns items vertically in the center */
}

    
                  #userPoints {
                      font-size: 1.2rem;
                      font-weight: bold;
                      color: rgb(19, 173, 14);
                 
                      border-radius: 5px;
                      padding: 5px 5px;
                     
                      display: inline-block;
                  }
              </style>

    <script>
      // Function to fetch and display user points
      const token1 = localStorage.getItem("token");
      const header = new Headers();
      header.append("Authorization", `Bearer ${token1}`);
     
      console.log(token1);
      function fetchUserPoints() {
          fetch('http://127.0.0.1:8091/api/v1/bills/get-user-points',
            {
              method:"GET",
              headers : header
            }
          )
              .then(response => response.json())
              .then(points => {
                  const pointsElement = document.getElementById('userPoints');
                  if (points !== null) {

                      pointsElement.textContent = `${points}`;
                  } else {
                      pointsElement.textContent = 'Points not found';
                  }
              })
              .catch(error => {
                  console.error('Error fetching user points:', error);
                  document.getElementById('userPoints').textContent = 'Your points : 0';
              });
      }

      // Call the function when the page loads
      document.addEventListener('DOMContentLoaded', fetchUserPoints);
  </script>

                  <div>
                    <button
                      type="button"
                      class="btn btn-primary btn-icon-text btn-rounded"
                    >
                      <i class="ti-clipboard btn-icon-prepend"></i>Report
                    </button>
                  </div>
                </div>
              </div>
            </div>
            <div class="row">
              <div class="col-md-6 grid-margin stretch-card">
                <div class="card">
                  <div class="card-body">
                    <p class="card-title">Upload Image</p>
                    <p class="text-muted font-weight-light">
                      Our advanced classification model accurately identifies
                      and categorizes waste into cardboard, glass, metal, paper,
                      plastic, and trash. By improving waste sorting, we
                      contribute to a cleaner environment and promote
                      sustainable waste management practices.
                    </p>
                    <div class="form-group">
                      <label for="weight-input" style="font-weight: 600"
                        >Enter Waste Weight (in kg):</label
                      >
                      <input
                        type="number"
                        class="form-control"
                        id="weight-input"
                        placeholder="e.g., 1.5"
                        step="0.01"
                        min="0"
                        style="
                          border-radius: 5px;
                          padding: 10px;
                          border: 1px solid #ced4da;
                        "
                      />
                    </div>

                    <div class="form-group">
                      <label for="location-input" style="font-weight: 600"
                        >Device Current Location:</label
                      >
                      <input
                        type="text"
                        class="form-control"
                        id="location-input"
                        placeholder="Latitude, Longitude"
                        readonly
                        style="
                          border-radius: 5px;
                          padding: 10px;
                          border: 1px solid #ced4da;
                        "
                      />
                      <button
                        type="button"
                        class="mt-2 btn btn-primary"
                        onclick="getCurrentLocation()"
                        style="border-radius: 5px"
                      >
                        Get Current Location
                      </button>
                    </div>
                    <div id="image-legend" class="mt-4 mb-2 chartjs-legend">
                      <div
                        class="upload-container"
                        style="
                          display: flex;
                          justify-content: center;
                          align-items: center;
                          background-color: #fcfcfc;
                          padding: 20px;
                        "
                      >
                        <div
                          class="card upload-card"
                          style="
                            border-radius: 10px;
                            box-shadow: 0 5px 10px 0 rgba(0, 0, 0, 0.3);
                            width: 400px;
                            height: 300px;
                            background-color: #ffffff;
                            padding: 20px;
                          "
                        >
                          <h3
                            class="upload-title"
                            style="font-size: 22px; font-weight: 600"
                          >
                            Upload Image
                          </h3>
                          <div
                            class="drop_box"
                            style="
                              margin: 10px 0;
                              padding: 30px;
                              display: flex;
                              align-items: center;
                              justify-content: center;
                              flex-direction: column;
                              border: 3px dotted #a3a3a3;
                              border-radius: 5px;
                              cursor: pointer;
                            "
                          >
                            <header>
                              <h4
                                style="
                                  font-size: 16px;
                                  font-weight: 400;
                                  color: #2e2e2e;
                                "
                              >
                                Drag & Drop or Click to Select Image
                              </h4>
                            </header>
                            <p
                              style="
                                margin-top: 10px;
                                margin-bottom: 20px;
                                font-size: 12px;
                                color: #a3a3a3;
                              "
                            >
                              Images Supported: JPG, JPEG, PNG
                            </p>
                            <input
                              type="file"
                              hidden
                              accept="image/*"
                              id="fileID"
                            />
                            <button
                              class="btn upload-btn"
                              style="
                                background-color: #005af0;
                                color: #ffffff;
                                padding: 10px 20px;
                                border: none;
                                outline: none;
                                transition: 0.3s;
                              "
                            >
                              Choose Image
                            </button>
                          </div>
                          <div
                            class="progress-bar"
                            style="
                              width: 100%;
                              background-color: #f3f3f3;
                              border-radius: 5px;
                              overflow: hidden;
                              height: 20px;
                              display: none;
                            "
                          >
                            <div
                              class="progress"
                              style="
                                width: 0%;
                                height: 100%;
                                background-color: #4caf50;
                              "
                            ></div>
                          </div>
                          <div
                            class="status-message"
                            style="
                              text-align: center;
                              margin-top: 10px;
                              display: none;
                            "
                          ></div>
                        </div>
                      </div>
                    </div>
                    <canvas id="image-chart"></canvas>
                  </div>
                  <div
                    class="card border-right-0 border-left-0 border-bottom-0"
                  >
                    <div
                      class="d-flex justify-content-center justify-content-md-end"
                    >
                      <div class="dropdown flex-md-grow-1 flex-xl-grow-0">
                        <div
                          class="dropdown-menu dropdown-menu-right"
                          aria-labelledby="dropdownMenuDate2"
                        ></div>
                      </div>
                      <button
                        class="border-0 btn btn-lg btn-outline-light text-primary rounded-0 d-none d-md-block"
                        type="button"
                      >
                        View all
                      </button>
                    </div>
                  </div>
                </div>
              </div>

              <div class="col-md-6 grid-margin stretch-card">
                <div class="card border-bottom-0">
                  <div class="pb-0 card-body">
                    <p class="card-title">Classification</p>
                    <p class="text-muted font-weight-light">
                      Our image classification model is designed to enhance
                      waste management efficiency by accurately identifying and
                      categorizing waste materials. By leveraging advanced
                      machine learning algorithms, we ensure precise and
                      reliable sorting, contributing to more effective recycling
                      and sustainable practices. Upload your image to see the
                      classification result and support our mission for a
                      cleaner environment.
                    </p>

                    <div class="flex-wrap mb-5 d-flex">
                      <div class="mt-3 me-5">
                        <p class="text-muted">Result</p>
                        <h3 id="result-card"></h3>
                      </div>
                    </div>
                    <!-- Image preview -->
                    <div
                      class="image-preview"
                      style="display: none; margin-top: 20px"
                    >
                      <img
                        id="uploaded-image"
                        src=""
                        alt="Uploaded Image"
                        style="
                          width: 100%;
                          max-height: 300px;
                          object-fit: cover;
                          border: 1px solid #ddd;
                          border-radius: 5px;
                        "
                      />
                    </div>
                  </div>
                  <canvas id="order-chart" class="w-100"></canvas>
                </div>
              </div>
            </div>
            <script>
              const username = localStorage.getItem("username");
              const token = localStorage.getItem("token");
              function getCurrentLocation() {
                if (navigator.geolocation) {
                  navigator.geolocation.getCurrentPosition(
                    function (position) {
                      const latitude = position.coords.latitude;
                      const longitude = position.coords.longitude;
                      document.getElementById(
                        "location-input"
                      ).value = `${latitude}, ${longitude}`;
                    },
                    function (error) {
                      alert(
                        "Unable to retrieve location. Please ensure location services are enabled."
                      );
                    }
                  );
                } else {
                  alert("Geolocation is not supported by this browser.");
                }
              }
            </script>

            <script>
              const dropArea = document.querySelector(
                  ".upload-container .drop_box"
                ),
                button = dropArea.querySelector(".upload-btn"),
                input = dropArea.querySelector("input"),
                progressBar = document.querySelector(".progress-bar"),
                progress = document.querySelector(".progress"),
                statusMessage = document.querySelector(".status-message"),
                uploadedImage = document.querySelector("#uploaded-image"),
                imagePreview = document.querySelector(".image-preview");

              button.onclick = () => {
                input.click();
              };

              input.addEventListener("change", handleFiles);
              dropArea.addEventListener("dragover", (e) => {
                e.preventDefault();
                dropArea.style.borderColor = "#005af0";
              });

              dropArea.addEventListener("dragleave", () => {
                dropArea.style.borderColor = "#a3a3a3";
              });

              dropArea.addEventListener("drop", (e) => {
                e.preventDefault();
                dropArea.style.borderColor = "#a3a3a3";
                const files = e.dataTransfer.files;
                if (files.length > 0 && files[0].type.startsWith("image/")) {
                  handleFiles({ target: { files: files } });
                } else {
                  displayMessage("Please drop a valid image file.", "error");
                }
              });

              function handleFiles(e) {
                const file = e.target.files[0];
                const weightInput =
                  document.getElementById("weight-input").value;
                const locationInput =
                  document.getElementById("location-input").value;

                if (file && file.type.startsWith("image/")) {
                  const formData = new FormData();
                  formData.append("file", file);
                  formData.append("weight", weightInput); // Append the weight
                  formData.append("location", locationInput); // Append the location

                  // Display image preview
                  const reader = new FileReader();
                  reader.onload = function (event) {
                    uploadedImage.src = event.target.result;
                    imagePreview.style.display = "block";
                  };
                  reader.readAsDataURL(file);

                  progressBar.style.display = "block";
                  statusMessage.style.display = "none";

                  const headers = new Headers();
                  headers.append("Authorization", `Bearer ${token}`);

                  fetch("http://localhost:8080/api/v1/upload", {
                    method: "POST",
                    headers: headers,
                    body: formData,
                  })
                    .then((response) => response.text())
                    .then((data) => {
                      displayMessage("Upload successful!", "success");
                      updateResult(data); // Update the result here
                      resetProgressBar();
                    })
                    .catch((error) => {
                      displayMessage("Upload failed.", "error");
                      resetProgressBar();
                    });

                  simulateProgress();
                } else {
                  displayMessage("Please select a valid image file.", "error");
                }
              }

              function displayMessage(message, type) {
                statusMessage.style.display = "block";
                statusMessage.style.color =
                  type === "success" ? "#4caf50" : "#f44336";
                statusMessage.textContent = message;
                setTimeout(() => {
                  statusMessage.style.display = "none";
                }, 3000);
              }

              function simulateProgress() {
                let width = 0;
                const interval = setInterval(() => {
                  if (width >= 100) {
                    clearInterval(interval);
                  } else {
                    width++;
                    progress.style.width = width + "%";
                  }
                }, 30);
              }

              function resetProgressBar() {
                setTimeout(() => {
                  progressBar.style.display = "none";
                  progress.style.width = "0%";
                }, 3000);
              }
            </script>

            <script>
              const resultHeading = document.querySelector("#result-card");

              function updateResult(responseText) {
                let result;
                try {
                  // Log the response text to inspect its format
                  console.log("Response Text:", responseText);

                  // Since the response is plain text, set result directly
                  result = responseText.trim();
                } catch (error) {
                  // Handle any errors that occur
                  console.error("Error processing response:", error);
                  result = "Error processing response";
                }

                // Update the result heading after a 3-second delay
                setTimeout(() => {
                  resultHeading.textContent = result;
                }, 3000);
              }
            </script>

            <div class="row">
              <div class="col-md-12 grid-margin stretch-card">
                <div class="card">
                  <div class="card-body">
                    <p class="mb-0 card-title">
                      Waste Classification Reports by me
                    </p>
                    <div class="table-responsive">
                      <table class="table table-hover" id="wasteDataTable">
                        <thead>
                          <tr>
                            <th>ID</th>
                            <th>Category</th>
                            <th>Collection Date</th>
                            <th>Weight</th>
                            <th>Location</th>
                            <th>Actions</th>
                          </tr>
                        </thead>
                        <tbody>
                          <!-- Data rows will be injected here -->
                        </tbody>
                      </table>
                    </div>
                  </div>
                </div>
              </div>

              <script>
                document.addEventListener("DOMContentLoaded", () => {
                  const tableBody = document.querySelector(
                    "#wasteDataTable tbody"
                  );
                  // Retrieve token and username from localStorage
                  const token = localStorage.getItem("token");
                  const username = localStorage.getItem("username");

                  // Create the headers object
                  const headers = new Headers();
                  headers.append("Authorization", `Bearer ${token}`);
                  console.log("token is ", token);

                  // Fetch waste data
                  fetch(
                    `http://127.0.0.1:8080/api/v1/waste/user?userId=${username}`,
                    {
                      method: "GET",
                      headers: headers,
                    }
                  )
                    .then((response) => response.json())
                    .then((data) => {
                      // Populate table
                      data.forEach((record) => {
                        const row = document.createElement("tr");
                        row.innerHTML = `
                                            <td>${record.id}</td>
                                            <td>${record.category}</td>
                                            <td>${new Date(
                                              record.collectionDate
                                            ).toLocaleDateString()}</td>
                                            <td>${record.weight}</td>
                                            <td>${record.location}</td>
                                            <td>
                                                <button class="border-0 btn btn-lg btn-outline-light text-primary rounded-0 d-none d-md-block" onclick="deleteRecord(${
                                                  record.id
                                                })">Delete</button>
                                            </td>
                                        `;
                        tableBody.appendChild(row);
                      });
                    })
                    .catch((error) =>
                      console.error("Error fetching data:", error)
                    );
                });

                const headers = new Headers();
                headers.append("Authorization", `Bearer ${token}`);
                // Function to delete a record
                function deleteRecord(wasteId) {
                  fetch(
                    `http://127.0.0.1:8080/api/v1/waste/delete/${wasteId}`,
                    {
                      method: "DELETE",
                      headers: headers,
                    }
                  )
                    .then((response) => {
                      if (response.ok) {
                        return response.text();
                      }
                      throw new Error("Network response was not ok.");
                    })
                    .then((message) => {
                      alert(message);
                      // Remove the record from the table
                      document
                        .querySelector(
                          `#wasteDataTable tbody tr:nth-child(${wasteId})`
                        )
                        .remove();
                    })
                    .catch((error) =>
                      console.error("Error deleting record:", error)
                    );
                }
              </script>

              <div class="row">
                <div class="col-md-12 grid-margin stretch-card">
                  <div class="card position-relative">
                    <div class="card-body">
                      <p class="card-title">Detailed Reports</p>
                      <div class="row">
                        <div
                          class="col-md-12 col-xl-3 d-flex flex-column justify-content-center"
                        >
                          <div class="ml-xl-4">
                            <h1 id="countDisplay">Loading...</h1>
                            <h3 class="font-weight-light mb-xl-4">
                              Reports count
                            </h3>
                            <p class="mb-2 text-muted mb-xl-0">
                              This figure represents the total number of waste
                              data entries recorded for the specified user. It
                              indicates the cumulative count of all waste
                              records associated with the user within the
                              selected date range.
                            </p>
                          </div>
                        </div>

                        <script>
                          document.addEventListener("DOMContentLoaded", () => {
                            const username = localStorage.getItem("username");

                            const countDisplay =
                              document.getElementById("countDisplay");
                            const token = localStorage.getItem("token");
                            const headers = new Headers();
                            headers.append("Authorization", `Bearer ${token}`);

                            // Fetch count data
                            fetch(
                              `http://localhost:8080/api/v1/waste/count/by-user?userId=${username}`,
                              {
                                method: "GET",
                                headers: headers,
                              }
                            )
                              .then((response) => response.text())
                              .then((data) => {
                                // Assuming the data is in the format "Count of waste data for userId X: Y"
                                const count = data.split(": ")[1];
                                countDisplay.textContent = count;
                              })
                              .catch((error) => {
                                console.error(
                                  "Error fetching count data:",
                                  error
                                );
                                countDisplay.textContent =
                                  "Error fetching data";
                              });
                          });
                        </script>

                        <div class="col-md-12 col-xl-9">
                          <div class="row">
                            <div class="mt-3 col-md-6 col-xl-5">
                              <canvas id="north-america-chart"></canvas>
                              <div id="north-america-legend"></div>
                            </div>
                            <div class="col-md-6 col-xl-7">
                              <div class="mb-3 table-responsive mb-md-0">
                                <table
                                  class="table table-borderless report-table"
                                >
                                  <tr>
                                    <td class="text-muted">Cardboard</td>
                                    <td class="px-0 w-100">
                                      <div class="mx-4 progress progress-md">
                                        <div
                                          id="progress-cardboard"
                                          class="progress-bar bg-primary"
                                          role="progressbar"
                                          style="width: 70%"
                                          aria-valuenow="70"
                                          aria-valuemin="0"
                                          aria-valuemax="100"
                                        ></div>
                                      </div>
                                    </td>
                                    <td>
                                      <h5
                                        id="count-cardboard"
                                        class="mb-0 font-weight-bold"
                                      >
                                        524
                                      </h5>
                                    </td>
                                  </tr>
                                  <tr>
                                    <td class="text-muted">Glass</td>
                                    <td class="px-0 w-100">
                                      <div class="mx-4 progress progress-md">
                                        <div
                                          id="progress-glass"
                                          class="progress-bar bg-primary"
                                          role="progressbar"
                                          style="width: 30%"
                                          aria-valuenow="30"
                                          aria-valuemin="0"
                                          aria-valuemax="100"
                                        ></div>
                                      </div>
                                    </td>
                                    <td>
                                      <h5
                                        id="count-glass"
                                        class="mb-0 font-weight-bold"
                                      >
                                        722
                                      </h5>
                                    </td>
                                  </tr>
                                  <tr>
                                    <td class="text-muted">Metal</td>
                                    <td class="px-0 w-100">
                                      <div class="mx-4 progress progress-md">
                                        <div
                                          id="progress-metal"
                                          class="progress-bar bg-primary"
                                          role="progressbar"
                                          style="width: 95%"
                                          aria-valuenow="95"
                                          aria-valuemin="0"
                                          aria-valuemax="100"
                                        ></div>
                                      </div>
                                    </td>
                                    <td>
                                      <h5
                                        id="count-metal"
                                        class="mb-0 font-weight-bold"
                                      >
                                        173
                                      </h5>
                                    </td>
                                  </tr>
                                  <tr>
                                    <td class="text-muted">Paper</td>
                                    <td class="px-0 w-100">
                                      <div class="mx-4 progress progress-md">
                                        <div
                                          id="progress-paper"
                                          class="progress-bar bg-primary"
                                          role="progressbar"
                                          style="width: 60%"
                                          aria-valuenow="60"
                                          aria-valuemin="0"
                                          aria-valuemax="100"
                                        ></div>
                                      </div>
                                    </td>
                                    <td>
                                      <h5
                                        id="count-paper"
                                        class="mb-0 font-weight-bold"
                                      >
                                        945
                                      </h5>
                                    </td>
                                  </tr>
                                  <tr>
                                    <td class="text-muted">Plastic</td>
                                    <td class="px-0 w-100">
                                      <div class="mx-4 progress progress-md">
                                        <div
                                          id="progress-plastic"
                                          class="progress-bar bg-primary"
                                          role="progressbar"
                                          style="width: 40%"
                                          aria-valuenow="40"
                                          aria-valuemin="0"
                                          aria-valuemax="100"
                                        ></div>
                                      </div>
                                    </td>
                                    <td>
                                      <h5
                                        id="count-plastic"
                                        class="mb-0 font-weight-bold"
                                      >
                                        553
                                      </h5>
                                    </td>
                                  </tr>
                                  <tr>
                                    <td class="text-muted">Trash</td>
                                    <td class="px-0 w-100">
                                      <div class="mx-4 progress progress-md">
                                        <div
                                          id="progress-trash"
                                          class="progress-bar bg-primary"
                                          role="progressbar"
                                          style="width: 75%"
                                          aria-valuenow="75"
                                          aria-valuemin="0"
                                          aria-valuemax="100"
                                        ></div>
                                      </div>
                                    </td>
                                    <td>
                                      <h5
                                        id="count-trash"
                                        class="mb-0 font-weight-bold"
                                      >
                                        912
                                      </h5>
                                    </td>
                                  </tr>
                                </table>

                                <script>
                                  document.addEventListener(
                                    "DOMContentLoaded",
                                    () => {
                                      const categories = [
                                        "Cardboard",
                                        "Glass",
                                        "Metal",
                                        "Paper",
                                        "Plastic",
                                        "Trash",
                                      ];

                                      categories.forEach((category) => {
                                        fetch(
                                          `http://127.0.0.1:8080/api/v1/waste/count/by-category/${category}`
                                        )
                                          .then((response) => response.text())
                                          .then((data) => {
                                            // Parse the count value from the response text
                                            const count = parseInt(
                                              data.match(/\d+/)[0],
                                              10
                                            );

                                            // Update the count and progress bar width
                                            document.getElementById(
                                              `count-${category.toLowerCase()}`
                                            ).innerText = count;

                                            // Assuming the max count is 1000 for percentage calculation, adjust if needed
                                            const progressPercentage =
                                              (count / 1000) * 100;
                                            document.getElementById(
                                              `progress-${category.toLowerCase()}`
                                            ).style.width = `${progressPercentage}%`;
                                            document
                                              .getElementById(
                                                `progress-${category.toLowerCase()}`
                                              )
                                              .setAttribute(
                                                "aria-valuenow",
                                                progressPercentage
                                              );
                                          })
                                          .catch((error) =>
                                            console.error(
                                              `Error fetching count for category ${category}:`,
                                              error
                                            )
                                          );
                                      });
                                    }
                                  );
                                </script>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <!-- content-wrapper ends -->
            <!-- partial:partials/_footer.html -->
            <footer class="footer">
              <div
                class="d-sm-flex justify-content-center justify-content-sm-between"
              >
                <span
                  class="text-center text-muted text-sm-left d-block d-sm-inline-block"
                  >Copyright ©
                  <a href="" target="_blank">wastemanage.lk </a>2024</span
                >
                <span
                  class="float-none mt-1 text-center float-sm-right d-block mt-sm-0"
                  >Only the best
                  <a href="" target="_blank"> Waste Collect</a> Processing</span
                >
              </div>
            </footer>
            <!-- partial -->
          </div>
          <!-- main-panel ends -->
        </div>
        <!-- page-body-wrapper ends -->
      </div>
      <!-- container-scroller -->
    </div>
    <!-- plugins:js -->
    <script src="vendors/base/vendor.bundle.base.js"></script>
    <!-- endinject -->
    <!-- Plugin js for this page-->
    <script src="vendors/chart.js/Chart.min.js"></script>
    <script src="js/jquery.cookie.js" type="text/javascript"></script>
    <!-- End plugin js for this page-->
    <!-- inject:js -->
    <script src="js/off-canvas.js"></script>
    <script src="js/hoverable-collapse.js"></script>
    <script src="js/template.js"></script>
    <script src="js/todolist.js"></script>
    <!-- endinject -->
    <!-- Custom js for this page-->
    <script src="js/dashboard.js"></script>
    <!-- End custom js for this page-->
  </body>
</html>
